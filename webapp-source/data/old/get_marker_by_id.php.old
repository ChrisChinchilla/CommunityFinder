<?php
include('./bootstrap.php');

$marker_id = $_POST['marker_id'];

$mysqli = new mysqli($SITE['DB_HOST'], $SITE['DB_USERNAME'], $SITE['DB_PW'], 'lukasber_theveggiebox');
if (!mysqli_connect_errno()) {
	if($stmt = $mysqli->prepare("SELECT marker.marker_id, username, title, description, type, subtype, lat, lng, tags, www, rss, 
																datetime_on, start_datetime, end_datetime, alt_contact_on, alt_contact_email, alt_contact_url, alt_contact_text 
														FROM marker, marker_to_user, user 
														WHERE marker.marker_id = marker_to_user.marker_id 
														AND marker_to_user.user_id = user.user_id 
														AND marker.marker_id = ? ")) {
	
		$stmt->bind_param("i", $marker_id);
	
		$stmt->execute();
	
		/* bind variables to prepared statement */
	   $stmt->bind_result($marker_id, $username, $title, $description, $type, $subtype, $lat, $lng, $tags, $www, $rss, $datetime_on, 
												$start_datetime, $end_datetime, $alt_contact_on, $alt_contact_email, $alt_contact_url, $alt_contact_text );
	
		header('Content-Type: text/xml');
		print('<markers>' . "\n");
		while ($stmt->fetch()) {		// fetch values
			print('<marker resource_id="' . $marker_id . '" username="' . $username . '" name="' . stripslashes($title) . '" description="' . stripslashes($description) . '" type="' . $type . '" subtype="' . $subtype . '" 
						lat="' . $lat . '" lng="' . $lng . '" tags="' . $tags . '" www="' . $www . '" rss="' . $rss . '" datetime_on="' . $datetime_on . '" start_datetime="' . $start_datetime . '"  
						end_datetime="' . $end_datetime . '" alt_contact_on="' . $alt_contact_on . '" alt_contact_emai="' . $alt_contact_email . '" alt_contact_url="' . $alt_contact_url . '" alt_contact_text="' . $alt_contact_text . '" />' . "\n");
		}
		print('</markers>' . "\n");
		$stmt->close(); // close statement
	}
	$mysqli->close(); // close connection
}
?>
