GMarker.prototype.openInformationWindow=function(e){var c=this.getLatLng();e=e=="edit"?3:0;var a=map.getBounds(),b=a.getNorthEast();a=a.getSouthWest();b.lat();b.lng();a.lat();a.lng();b='<div class="info_window">';b+="<b>"+this.name+' (<a class="tag_link" href="#" title="Show all listings of category \''+this.subtype_name+"' in the current map area.\" onclick=\"application.resourceManager.widgetRunSearch({forceLoad:1, text:'"+this.subtype_name+"'});return false;\">"+this.subtype_name+'</a>)</b><br><span style="color: grey;">Added by: <a href="#" onclick="application.panelManager.openProfileWindow(\''+
this.username+"');return(false);\">"+this.username+"</a></span>";b+="<p>"+this.desc+"</p>";if(this.phone)b+="<p><b>Phone: </b>"+this.phone+"</p>";if(this.address)b+="<p><b>Address: </b>"+this.address+"</p>";this.current_window="openInformationWindow";if(this.datetime_on==1){b+="<b>Start : </b>"+this.start_datetime.getDate()+"-"+(this.start_datetime.getMonth()+1)+"-"+this.start_datetime.getFullYear()+" <br/>";b+="<b>End : </b>"+this.end_datetime.getDate()+"-"+(this.end_datetime.getMonth()+1)+"-"+this.end_datetime.getFullYear()+
" <br/>"}b+="<br />";for(var d in this.tags){b+="<b> "+d.replace(/_/g," ")+":</b> ";a="";for(var f in this.tags[d]){var g="<a title=\"Show all listings tagged with '"+this.tags[d][f]+'\' in the current map area" class="tag_link" href="#" onclick="application.resourceManager.widgetRunSearch({forceLoad: 1, openExact: 1, text:\''+this.tags[d][f]+"'});return(false);\">"+this.tags[d][f]+"</a>";a+=a?", "+g:g}b+=a}if(this.wiki!=undefined&&this.wiki!=""){b+="<hr/>";b+='<b>Wikipedia: </b><a target="_blank" href="http://en.wikipedia.org/wiki/'+
this.wiki+'">http://en.wikipedia.org/wiki/'+this.wiki+"</a><br/>"}if(this.www!=undefined&&this.www!="")if(this.rss!=undefined&&this.rss!=""){b+="<hr/>";b+='<b>Latest News from : </b><a id="listing_site_preview" " target="_blank" href="'+this.www+'">'+this.www+"</a>";b+='<div id="latest_news" style="height: 60px; overflow:hidden; text-align: center; padding-top:10px;">&nbsp;<br/><img src="./images/wait_small.gif"/> &nbsp; <b>Loading...</b><br><br>&nbsp;<br/></div>';b+='<img style="margin-bottom: -4px;" src="/images/rss.gif" />  <a target="_blank" href="'+
this.rss+'" title="">Copy this link to save RSS Feed</a>'}else{b+="<hr/>";b+='<b>Web : </b><a id="listing_site_preview" target="_blank" href="'+this.www+'">'+this.www+"<a/><br>"}else if(this.rss!=undefined&&this.rss!=""){b+="<b>Latest News : </b><br/>";b+='<div style="margin-left: 60px; margin-top: 0px">&nbsp;<br/><img src="./images/wait_small.gif"/> &nbsp; <b>Loading...</b><br/></div>';b+='<img style="margin-bottom: -4px;" src="/images/rss.gif" />  <a target="_blank" href="'+this.rss+'" title="">Copy this link to save RSS Feed</a>'}b+=
this.invite_email?'<hr/><img style="margin-bottom: -4px;" src="/images/listing_contact.jpg"/> <a href=""# onclick="application.user.refreshConversationNew(\''+this.invite_email+"', 'email'); application.panelManager.openInboxWindow(); return(false);\">Contact</a> ":this.invite_url?'<hr/><img style="margin-bottom: -4px;" src="/images/listing_contact.jpg"/> <a target="_blank" href="'+this.invite_url+'">Contact</a> ':this.invite_text?'<hr/><img style="margin-bottom: -4px;" src="/images/listing_contact.jpg"/> <a href="#" onclick="application.user.refreshConversationNew(\''+
this.invite_text+"', 'text'); return(false);\">Contact</a> ":'<hr/><img style="margin-bottom: -4px;" src="/images/listing_contact.jpg"/> <a href="#" onclick="application.user.refreshConversationNew(\''+this.username+"', 'username'); return(false);\">Contact</a> ";b+='| <img style="margin-bottom: -4px;" src="/images/twitter_share.png" /> <a target="_blank" href="http://twitter.com/home?status=Just found '+this.name+". http://victoriamycommunity.org/index.php?lid="+this.lid+'">Tweet It</a> ';b+='| <img style="margin-bottom: -4px;" src="/images/facebook_share.gif" /> <a target="_blank" href="http://www.facebook.com/sharer.php?u=http://victoriamycommunity.org/index.php?lid='+
this.lid+'">Share on Facebook</a> ';b+="<br/>";b+="</div>";a='<div class="info_window" style="overflow: auto; height: 180px;">';a+='<div id="listing_comments" style="overflow: auto; display: none;">';a+='<div id="listing_comments_results"></div>';a+="</div>";a+='<div id="listing_comments_add" style="display: none;">';a+='<form action="#" name="comment_form">';a+='<textarea name="comment" style="width:400px; height:100px;"></textarea><br>';a+='<div class="fg-buttonset fg-buttonset-multi fg-comment">';
a+='<input type="button" value="Add Comment" class="fg-button fg-button-icon-left ui-state-default ui-corner-all" onclick="application.resourceManager.current_marker.addCommentToDB(this.form);return(false);">';a+="</div>";a+="</form>";a+="</div>";a+='<div id="listing_comments_report" style="display: none;">';a+='<form action="#" name="report_form">';a+='<input type="radio" name="report_type" value="date"/>Content is out of Date <br/>';a+='<input type="radio" name="report_type" value="inap"/>Content is inapropriate <br/>';
a+='<b>Reason: </b><input name="details" style="width: 200px;" /><br/>';a+='<div class="fg-buttonset fg-buttonset-multi fg-comment">';a+='<input type="button" value="Report" class="fg-button fg-button-icon-left ui-state-default ui-corner-all" onclick="application.resourceManager.current_marker.reportCommentToDB(this.form);return(false);">';a+="</div>";a+="</form>";a+="</div>";a+='<div id="comment_controls">';a+='<form style="padding-top: 0.4em; border-top: 1px solid black; position: absolute; bottom: 0; left:0; width: 100%;">';
a+='<div class="fg-buttonset fg-buttonset-multi fg-comment">';a+='<a onclick="$(\'#listing_comments\').hide();$(\'#comment_controls\').hide(); $(\'#listing_comments_add\').show(); return(false);" class="fg-button fg-button-icon-left ui-state-default ui-corner-all" style="padding-left: 2.1em; margin-left: 1em;" href="#" title="Add Comment"><span class="ui-icon ui-icon-circle-plus"></span>Add Comment</a> &nbsp;';a+='<a onclick="$(\'#listing_comments\').hide();$(\'#comment_controls\').hide(); $(\'#listing_comments_report\').show(); return(false);" class="fg-button fg-button-icon-left ui-state-default ui-corner-all" style="padding-left: 2.1em; margin-left: 1em;" href="#" title="Report Inappropriate Content"><span class="ui-icon ui-icon-alert"></span>Report Content to Moderator</a>';
a+="</div>";a+="</form></div>";a+="</div>";g='<div class="info_window" style="height: 130px; overflow:hide;">';g+='<p><img style="margin-bottom: -4px;" src="/images/twitter_share.png" /> <a target="_blank" href="http://twitter.com/home?status=Just found '+this.name+". http://victoriacommunity.org/index.php?lid="+this.lid+'">Tweet about it on Twitter</a></p>';g+='<p><img style="margin-bottom: -4px;" src="/images/facebook_share.gif" /> <a target="_blank" href="http://www.facebook.com/sharer.php?u=http://victoriamycommunity.org/index.php?lid='+
this.lid+'">Share it on Facebook</a></p>';g+="<p><img style=\"margin-bottom: -4px;\" src=\"/images/link_share.jpg\" /> <a href=\"#\" onclick=\"$('#link_code').toggle('normal');$('#embed_code').hide('slow'); return(false);\">Email / Link to this Listing</a></p>";g+='<p id="link_code" style="display:none;">Cut and Paste the following code to link to this linsting: <br/>';g+='<input type="text" style="width: 280px;" value="http://www.victoriamycommunity.org/index.php?zoom='+map.getZoom()+"&lat="+c.lat()+
"&lng="+c.lng()+"&lid="+this.lid+'" /></p>';g+="<p><img style=\"margin-bottom: -4px;\" src=\"/images/embed_share.jpg\" /> <a href=\"#\" onclick=\"$('#embed_code').toggle('normal');$('#link_code').hide('slow'); return(false);\">Embed this Listing / Map into your website</a></p>";g+='<p id="embed_code" style="display:none;">Cut and Paste the following code to embed this linsting: <br/>';g+='<input type="text" style="width: 280px;" value="<iframe src=&quot;http://www.victoriamycommunity.org/index.php?zoom='+
map.getZoom()+"&lat="+c.lat()+"&lng="+c.lng()+"&lid="+this.lid+'&quot; style=&quot;width: 600px; height:400px; border:none;&quot;></iframe>" /></p>';g+="</div>";if(application.user.isLoggedIn()&&application.user.username==this.username||this.username==="anonymous"){c='<form class="fg-form"><div class="info_window" style="overflow: auto; height: 180px;">';c+="";c+="<table><tr><td><b>Category: </b></td><td><b>"+this.subtype+" ("+this.type+")</b></td></tr>";c+='<tr><td><b>Title</b></td><td> <input name="name" value="'+
this.name+'" style="width: 220px;" class="fg-input ui-corner-all"/><span title="The title that appears on the listing" style="float: right;" class="tag_link ui-icon ui-icon-info"></span></td></tr>';c+='<tr><td><b>Description: </b></td><td> <textarea name="description" cols="35" rows="2" class="fg-input ui-corner-all" style="width: 220px;">'+this.desc+'</textarea><span title="The main description that appears on the listing" class="tag_link ui-icon ui-icon-info" style="float: right;"></span></td></tr>';
c+='<tr><td><b>Phone: </b></td><td> <input name="phone" value="'+this.phone+'" style="width: 220px;" class="fg-input ui-corner-all"/></td></tr>';c+='<tr><td><b>Address: </b></td><td> <input name="address" value="'+this.address+'" style="width: 220px;" class="fg-input ui-corner-all"/></td></tr>';c+='<tr><td colspan="2"><hr/></td></tr>';c+='<tr><td colspan="2"><b>Tags</b><span title="Tags provide extra detail and help people find your listing.  Just start typing and popular terms that others have used will be suggested, use a comma to separate tags" class="tag_link ui-icon ui-icon-info" style="float: right;"></span></td></tr>';
d=this.tags!=null&&this.tags.general?this.tags.general.join(","):"";c+='<tr><td><b>general:</b></td><td> <input name="tags_general" id="tags_general" value="'+d+'" class="fg-input ui-corner-all" style="width: 220px;"/></td></tr>';if(application.resourceManager.marker_types[this.subtype].prefixes!="")for(f in application.resourceManager.marker_types[this.subtype].prefixes){d=application.resourceManager.marker_types[this.subtype].prefixes[f];d=d.replace(/\s/g,"_");var h=application.resourceManager.marker_types[this.subtype].prefixes_help[f],
j=this.tags[d]?this.tags[d].join(","):"";c+="<tr><td><b>"+d.replace(/_/g," ")+':</b></td><td> <input name="tags_'+d+'" id="tags_'+d+'" value="'+j+'" class="fg-input ui-corner-all" style="width: 220px;"/></td></tr>';c+='<tr><td></td><td style="color: grey;">'+h+"</td></tr>"}c+='<tr><td colspan="2"><hr/></td></tr>';c+='<tr><td><b>Wikipedia Page:</b></td><td> <input id="wiki" name="wiki" value="'+this.wiki+'" class="fg-input ui-corner-all" style="width: 220px;"/><span title="Links listing to associated Wikipedia page, just start typing and we\'ll suggest exisiting pages on wikipedia" class="tag_link ui-icon ui-icon-info" style="float: right;"></span></td></tr>';
c+='<tr><td colspan="2"><hr/></td></tr>';c+='<tr><td><b>WWW (ie http://..):</b></td><td> <input name="www" value="'+this.www+'" class="fg-input ui-corner-all" style="width: 220px;"/><span title="Links listing to an associated Web Site" class="tag_link ui-icon ui-icon-info" style="float: right;"></span></td></tr>';c+='<tr><td><b>RSS: (ie http://..)</b></td><td> <input name="rss" value="'+this.rss+'" class="fg-input ui-corner-all" style="width: 220px;" /></td></tr>';d=this.is_invite==1?'checked="checked"':
"";h=this.is_invite==1?"":"display: none;";c+='<tr><td colspan="2"><hr/></td></tr>';c+='<tr><td colspan="2"><input onclick="$(\'.invite_details\').toggle();" type="checkbox" name="is_invite" '+d+" class=\"fg-input ui-corner-all\" /> <b>Customise 'contact us' link</td></tr>";c+='<tr class="invite_details" style="'+h+"\"><td  colspan=\"2\" >Instead of using the built in inbox system, provide either an email address, or 'contact us' form url to customise the 'contact user' link on this listing.</td></tr>";
c+='<tr class="invite_details" style="'+h+'"><td><b>Email:</b></td><td> <input name="invite_email" value="'+this.invite_email+'" size="35" class="fg-input ui-corner-all"/> or </td></tr>';c+='<tr class="invite_details" style="'+h+'"><td><b>Contact URL:</b></td><td> <input name="invite_url" value="'+this.invite_url+'" size="35" class="fg-input ui-corner-all"/></td></tr>';c+='<tr><td colspan="2"><hr/></td></tr>';c+="</table></div>";c+="<hr/>";c+='<button type="button" onClick="application.resourceManager.current_marker.updateToDB(this.form)" class="ui-corner-all fg-button ui-state-default" style="float:left;"  >Save</button>';
c+=application.user.isLoggedIn()?'<button type="button" onClick="application.resourceManager.current_marker.deleteToDB();" class="ui-corner-all fg-button ui-state-default" style="float:right; background: red;">Delete this Listing</button>\t':'<b>Note</b>: You need to <a href="#" onclick="application.panelManager.openLoginWindow(); return(false);">Login</a> to delete anonymous listings.';c+="</form>";this.openInfoWindowTabsHtml([new GInfoWindowTab("Info",b),new GInfoWindowTab("Comment",a),new GInfoWindowTab("Share",
g),new GInfoWindowTab("Edit",c)],{selectedTab:e})}else this.openInfoWindowTabsHtml([new GInfoWindowTab("Info",b),new GInfoWindowTab("Comment",a),new GInfoWindowTab("Share",g)],{selectedTab:e});addDatepicker=function(){$("#datepicker").datepicker({inLine:false,dateFormat:"dd-mm-yy"});$("#datepicker_end").datepicker({inLine:false,dateFormat:"dd-mm-yy"})};setTimeout("addDatepicker()",2E3);this.rss!=undefined&&this.rss!=""&&$.getFeed({url:"/rss_proxy/?url="+this.rss,success:function(o){var p="<ul>";for(var m in o.items){var q=
o.items[m];p+='<li><a href="'+q.link+'">'+q.title+"</a> : "+q.description+"</li>"}p+="</ul>";$("#latest_news").html(p).find("ul").ticker("init",{delay:5E3,speed:500,linked:true,selection:"li",animations:{_in:"fadeIn",out:"fadeOut"}}).ticker("loop")}});var k='<img src="http://www.shrinktheweb.com/xino.php?embed=1&STWAccessKeyId=35b970f614349ea&stwsize=xlg&stwUrl='+this.www+'" />';addPreview=function(){$("#listing_site_preview").qtip({content:k,position:{corner:{tooltip:"bottomMiddle",target:"topMiddle"}},
style:{tip:true,name:"green",width:320,padding:0,tooltip:{padding:0},content:{padding:0},border:{width:4,radius:6}},show:{solo:true}})};setTimeout("addPreview()",2E3);addTagLinks=function(){$(".tag_link").qtip({position:{corner:{tooltip:"bottomMiddle",target:"topMiddle"}},style:{tip:true,name:"green",fontWeight:800,border:{width:4,radius:6},textAlign:"center"},show:{solo:true}})};setTimeout("addTagLinks()",2E3);fixButtons=function(){$(".fg-button:not(.ui-state-disabled)").hover(function(){$(this).addClass("ui-state-hover")},
function(){$(this).removeClass("ui-state-hover")}).mousedown(function(){$(this).parents(".fg-buttonset-single:first").find(".fg-button.ui-state-active").removeClass("ui-state-active");$(this).is(".ui-state-active.fg-button-toggleable, .fg-buttonset-multi .ui-state-active")?$(this).removeClass("ui-state-active"):$(this).addClass("ui-state-active")}).mouseup(function(){$(this).is(".fg-button-toggleable, .fg-buttonset-single .fg-button,  .fg-buttonset-multi .fg-button")||$(this).removeClass("ui-state-active")})};
setTimeout("fixButtons()",2E3);setTimeout('$("#wiki").autocomplete({url: "/data/autocomplete_wikipedia.php", multiple: false, mustMatch:true})',2E3);setTimeout('$("#tags_general").autocomplete({url: "/data/autocomplete_tags.php", multiple: true,multipleSeparator: ",",extraParams: { prefix: "" }})',2E3);setTimeout('$("#tags_general").keyup(function(e) { if(e.keyCode == 188) { return(false);}});',3E3);for(f in application.resourceManager.marker_types[this.subtype].prefixes){d=application.resourceManager.marker_types[this.subtype].prefixes[f];
prefix_ref=d.replace(/\s/g,"_");setTimeout('$("#tags_'+prefix_ref+'").autocomplete({url: "/data/autocomplete_tags.php", multiple: true,multipleSeparator: ",",extraParams: { prefix: "'+d+'" }})',2E3)}this.loadComments()};
GMarker.prototype.addToDB=function(){var e=this.getLatLng(),c=this,a="/data/add_resource.php?";a+="title="+this.name+"&";a+="description="+this.desc+"&";a+="type="+this.type+"&";a+="subtype="+this.subtype+"&";a+="lat="+e.lat()+"&";a+="lng="+e.lng();$.post("/data/add_resource.php",{title:this.name,desc:this.desc,type:this.type,subtype:this.subtype,lat:e.lat(),lng:e.lng()},function(b){if($(b).find("response_state").attr("success")=="true"){c.lid=$(b).find("marker").attr("lid");application.resourceManager.markers[c.lid]=
c}})};GMarker.prototype.deleteToDB=function(){var e=this;$.post("/data/delete_resource.php",{lid:this.lid},function(){map.removeOverlay(e);application.resourceManager.markers[e.lid].deleted=true})};
GMarker.prototype.updateToDB=function(e){this.name=e.elements.name.value;this.desc=e.elements.description.value;this.phone=e.elements.phone.value;this.address=e.elements.address.value;this.is_invite=e.elements.is_invite.checked==true?1:0;this.invite_email=e.elements.invite_email.value;this.invite_url=e.elements.invite_url.value;this.invite_url=this.invite_url.match(/^http:\/\//)||this.invite_url==""?this.invite_url:"http://"+this.invite_url;this.wiki=e.elements.wiki.value;this.www=e.elements.www.value;
this.www=this.www.match(/^http:\/\//)||this.www==""?this.www:"http://"+this.www;this.rss=e.elements.rss.value;lat_lng=this.getLatLng();if(e.elements.tags_general.value)this.tags.general=e.elements.tags_general.value.split(",");else delete this.tags.general;for(var c in application.resourceManager.marker_types[this.subtype].prefixes){var a=application.resourceManager.marker_types[this.subtype].prefixes[c];a=a.replace(/\s/g,"_");var b=e.elements["tags_"+a].value;b=b.replace(/,,+/,",");current_filed=
b.replace(/^,|,$/g,"");current_filed=b.replace(/^,/,"");if(b){if(this.tags[a]==undefined)this.tags[a]=[];this.tags[a]=b.split(",")}else delete this.tags[a]}e="";for(a in this.tags)for(c in this.tags[a])e+=a=="general"?","+this.tags[a][c]:","+a.replace(/_/g," ")+":"+this.tags[a][c];$.post("/data/update_resource.php",{lid:this.lid,title:this.name,desc:this.desc,type:this.type,subtype:this.subtype,lat:lat_lng.lat(),lng:lat_lng.lng(),www:this.www,wiki:this.wiki,rss:this.rss,is_invite:this.is_invite,invite_email:this.invite_email,
invite_url:this.invite_url,address:this.address,phone:this.phone,tags:e});application.resourceManager.current_marker.openInformationWindow()};GMarker.prototype.addCommentToDB=function(e){$.post("/data/add_listing_comment.php",{lid:this.lid,comment_text:e.elements.comment.value});this.loadComments();$("#listing_comments_add").hide()};GMarker.prototype.reportCommentToDB=function(){this.loadComments();$("#listing_comments_report").hide()};
GMarker.prototype.loadComments=function(){var e=this;$("#listing_comments_results").html("");$.get("/data/get_marker_comments.php",{lid:e.lid},function(c){var a=0;$(c).find("comment").each(function(){a=1;var b=$(this).find("comment_text").text(),d=$(this).find("username").text(),f=$(this).find("name").text(),g=$(this).find("timestamp").text();$("#listing_comments_results").append('<p><a href="#" onclick="application.panelManager.openProfileWindow(\''+d+"');return(false);\">"+d+"</a>:"+f+" ("+g+")<br/>"+
b+"</p>")});a==0&&$("#listing_comments_results").html('<p><b>No Comments Added</b><br/><br/>be the first to <a onclick="$(\'#listing_comments\').hide(); $(\'#listing_comments_add\').show(); return(false);" class="" style="" href="#" title="Add Comment">add a comment</a> about '+e.name+"</p>");$("#listing_comments").show()});$("#comment_controls").show()};
function ResourceManager(e){var c=this;this.marker_types=[];this.markers=[];this.markers_cluster_id=[];this.current_marker=null;this.restrict_subtype=this.current_filter_username=this.current_filter_text=this.current_filter_subtype="";this.restrict_username=null;this.addMarkerTypes=function(a){var b=new GIcon;b.image="http://www.google.com/mapfiles/markera.png";b.shadow="http://www.victoriamycommunity.org/images/shadow.png";b.iconSize=new GSize(30,30);b.shadowSize=new GSize(31,32);b.iconAnchor=new GPoint(16,
16);b.infoWindowAnchor=new GPoint(13,1);var d=new GIcon(b);d.image="/images/cluster.png";d.iconSize=new GSize(40,40);d.shadow=null;this.cluster=new ClusterMarker(e,{intersectPadding:-6,clusterMarkerIcon:d});$.get("/data/get_subtypes.php",{restrict_subtype:c.restrict_subtype},function(f){var g="";$(f).find("icon").each(function(){var h=$(this).attr("subtype"),j=$(this).attr("type"),k=$(this).attr("is_addable"),o=$(this).attr("image"),p=$(this).attr("subtype_name"),m=$(this).attr("type_name"),q=$(this).attr("prefixes")?
$(this).attr("prefixes").split(","):null,t=$(this).attr("prefixes_help");c.marker_types[h]=new GIcon(b);c.marker_types[h].image=o;c.marker_types[h].subtype=h;c.marker_types[h].type=j;c.marker_types[h].is_addable=k;c.marker_types[h].subtype_name=p;c.marker_types[h].type_name=m;c.marker_types[h].prefixes=q;c.marker_types[h].prefixes_help=t.split("_");if(g!=m){g=m;$("#search_subtype_checkboxes").append("<b>"+m+"</b><br>")}$("#search_subtype_checkboxes").append('<input type="checkbox" name="subtype" value="'+
h+'" checked="checked"/>'+p+"<br />")});typeof a=="function"&&a()})};this.addResource=function(a){if(a){a=this.createMarker({username:application.user.username,point:application.current_point,subtype:a.subtype.value,subtype_name:c.marker_types[a.subtype.value].subtype_name,type_name:c.marker_types[a.subtype.value].type_name});a.username=application.user.isLoggedIn()?a.username:"anonymous";application.resourceManager.current_marker=a;e.addOverlay(a);a.openInformationWindow("edit");a.addToDB()}};this.createMarker=
function(a){var b=new GMarker(a.point,{icon:application.resourceManager.marker_types[a.subtype],title:a.name+" ("+a.subtype+")"});b.lid=a&&a.lid?a.lid:null;b.username=a&&a.username?a.username:"";b.type=a&&a.type?a.type:"";b.subtype=a&&a.subtype?a.subtype:"";b.subtype_name=a&&a.subtype_name?a.subtype_name:"";b.name=a&&a.name?a.name:"";b.desc=a&&a.desc?a.desc:"";b.www=a&&a.www?a.www:"";b.wiki=a&&a.wiki?a.wiki:"";b.rss=a&&a.rss?a.rss:"";b.address=a&&a.address?a.address:"";b.phone=a&&a.phone?a.phone:
"";b.datetime_on=a&&a.datetime_on?a.datetime_on:"";var d=a&&a.start_datetime_on?a.start_datetime_on:0,f=a&&a.end_datetime_on?a.end_datetime_on:0;b.start_datetime=new Date;if(d!=""&&!d.match(/0000/)){d=d.split(/\W/);b.start_datetime.setUTCFullYear(d[0],d[1]-1,d[2]);b.start_datetime.setUTCHours(d[3],d[4])}b.end_datetime=new Date;if(f!=""&&!f.match(/0000/)){f=f.split(/\W/);b.end_datetime.setUTCFullYear(f[0],f[1]-1,f[2]);b.end_datetime.setUTCHours(f[3],f[4])}f=a&&a.tags?a.tags:"";b.tags=[];if(f!=""){f=
f.split(",");for(var g in f)if(f[g].match(/:/)){d=f[g].split(":");d[0]=d[0].replace(/\s/g,"_");if(b.tags[d[0]]==undefined)b.tags[d[0]]=[];b.tags[d[0]].push(d[1])}else{if(b.tags.general==undefined)b.tags.general=[];b.tags.general.push(f[g])}}b.current_window=null;b.is_invite=a&&a.ac_on?a.ac_on:"";b.invite_email=a&&a.ac_email?a.ac_email:"";b.invite_url=a&&a.ac_url?a.ac_url:"";return b};this.openMarker=function(a){if(this.markers_cluster_id[a]!=undefined){application.resourceManager.cluster.triggerClick(this.markers_cluster_id[a]);
this.current_marker=this.markers[a];application.panelManager.closeAllPanels()}else if(this.markers[a]){this.markers[a].openInformationWindow();this.current_marker=this.markers[a];application.panelManager.closeAllPanels()}else c.loadMarkers({lid:a,openExact:1,wideSearch:1,activeLoad:1})};this.blockSearch=0;this.widgetRunSearch=function(a){application.panelManager.hideAdvanced();$("#search_widget_button").html('<img src="http://victoriamycommunity.org/images/wait_small_white.gif"/>');$("#search_indicator").show();
if(a&&(a.subtypes!=undefined||a.text!=undefined||a.username!=undefined)){b=a.subtypes?a.subtypes:"all";d=a.text?a.text:"";f=a.usernames?a.usernames:"";c.current_filter_subtype=b;c.current_filter_text=d;c.current_filter_username=f;$("#search_subtype_checkboxes input").each(function(){var h=new RegExp($(this).val(),"i");b.search(h)!=-1?$(this).attr("checked",true):$(this).attr("checked",false)});$("#search_text").val(d);application.panelManager.flashSearchBox()}else{var b="";$("#search_subtype_checkboxes input:checked").each(function(){b+=
$(this).val()+","});b=b.substring(0,b.length-1);b=b.match(/^ALL/)?"ALL":b;var d=$("#search_text").val(),f=$("#search_only_user_input").val();c.current_filter_subtype=b;c.current_filter_text=d;c.current_filter_username=f}var g=0;if(a&&a.forceLoad){c.blockSearch=0;g=1}a&&a.openExact?c.loadMarkers({subtype:b,text:d,username:f,openExact:1,activeLoad:g}):c.loadMarkers({subtype:b,text:d,username:f,activeLoad:g})};$("#search_check_all").click(function(){var a=this.checked;$("input[name=subtype]").each(function(){this.checked=
a})});this.loadMarkers=function(a){var b=a&&a.activeLoad?a.activeLoad:0,d=a&&a.text?a.text:"",f=a&&a.subtype?a.subtype:"";if(f==""||f=="ALL"||f=="all")f=c.restrict_subtype;var g=a&&a.username?a.username:"";g=c.restrict_username?c.restrict_username:g;var h=a&&a.openExact?a.openExact:"",j=a&&a.lid?a.lid:"";if(a&&a.wideSearch?a.wideSearch:"")var k="",o="",p="",m="";else{k=e.getBounds();o=k.getNorthEast();m=k.getSouthWest();k=o.lat();o=o.lng();p=m.lat();m=m.lng()}$.getJSON("/data/get_markers.php",{format:"json",
north_lat:k,east_lng:o,south_lat:p,west_lng:m,filter_text:d,filter_subtype:f,username:g,listing_id:j},function(q){if(!c.blockSearch||b){var t=[],s="";c.clearAllMarkers();var w=0,A=null;$.each(q.markers,function(x,n){w=x+1;n.point=new GLatLng(parseFloat(n.lat),parseFloat(n.lng));A=n.lid;var l=c.createMarker(n),u=l.desc.length>160?l.desc.substring(0,160)+"...":l.desc;u=u?u+"<br/>":"";var C=l.address?"<br/>Address: "+l.address+"<br/>":"",D=l.phone?"<br/>Phone: "+l.phone+"<br/>":"",v="";if(l.tags!=null)for(var r in l.tags){v+=
v?". &nbsp; <b> "+r.replace(/_/g," ")+":</b> ":"<b> "+r.replace(/_/g," ")+":</b> ";var y="";for(var z in l.tags[r]){var B='<a class="tag_link" href="#" title="Show all listings tagged with \''+l.tags[r][z]+"' in the current map area.\" onclick=\"application.resourceManager.widgetRunSearch({text:'"+l.tags[r][z]+"'});return false;\">"+l.tags[r][z]+"</a>";y+=y?", "+B:B}v+=y}s+='<div style="padding: 0.4em 0.6em;"><div style="margin: 4px 0px;  border-top: 1px dotted;"><a href="#" onclick="application.resourceManager.openMarker('+
n.lid+'); application.panelManager.hideResults(); return(false);">'+n.name+'</a> &nbsp; (<a class="tag_link" href="#" title="Show all listings of category \''+n.subtype_name+"' in the current map area.\" onclick=\"application.resourceManager.widgetRunSearch({text:'"+n.subtype_name+"'});return false;\">"+n.subtype_name+'</a>)</div><div class="subtle_text" style="font-size: 0.9em;"> '+u+C+D+'</div><div class="subtle_text" style="font-size: 0.9em; margin-top:0.2em;">'+v+"</div></div>";t[x]=l;c.markers[n.lid]=
l;c.markers_cluster_id[n.lid]=x});if(s==""){s='<div style="padding: 0.4em 0.6em;">Sorry, there are no matching listings in this area, try <a href="#" onclick="map.zoomOut(); application.resourceManager.endMapDrag(); return false;">zooming out</a> or <a href="#" onclick="$(\'#search_text\').focus().select();application.panelManager.flashSearchBox();return(false);">change your search</a>.</div>';$("#searchPanelNoResults").html(s);$("#searchPanelResultsFound").html('<b><span style="font-size: 1.2em;">0</span> results found</b>');
typeof callback=="function"&&callback();application.panelManager.showNoResults()}else{$("#searchPanelResultsListings").html(s);$("#searchPanelResultsFound").html('<b><span style="font-size: 1.2em;">'+w+"</span> results found </b>");application.resourceManager.cluster.addMarkers(t);application.resourceManager.cluster.refresh();application.panelManager.hideNoResults();application.panelManager.feedsCustomize();if(h&&w===1)application.resourceManager.openMarker(A);else a&&a.activeLoad&&application.panelManager.showResults()}$("#map_filter_center").animate({backgroundColor:"#FFDE40"},
{queue:true,duration:200}).animate({backgroundColor:application.panelManager.search_bg_color},{queue:true,duration:1E3});e.enableDragging();c.markerTip=function(){$("img[id^='mtgt']").qtip({position:{corner:{tooltip:"bottomMiddle",target:"topMiddle"}},style:{tip:true,name:"green",fontWeight:800,border:{width:4,radius:6},textAlign:"center"},show:{solo:true}})};setTimeout("application.resourceManager.markerTip()",1E3);$(".tag_link").qtip({position:{corner:{tooltip:"bottomMiddle",target:"topMiddle"}},
style:{tip:true,name:"green",fontWeight:800,border:{width:4,radius:6},textAlign:"center"},show:{solo:true}})}$("#search_widget_button").html("Go");$("#search_indicator").hide()})};this.clearAllMarkers=function(){this.markers=[];this.markers_cluster_id=[];this.cluster.removeMarkers();e.clearOverlays()};this.drag_timer=null;this.endMapDrag=function(){clearTimeout(c.drag_timer);c.drag_timer=setTimeout("application.resourceManager.triggerDragLoad()",1E3)};this.startMapDrag=function(){clearTimeout(c.drag_timer)};
this.triggerDragLoad=function(){if(!this.blockSearch){$("#search_text").autocomplete("flushCache");e.disableDragging();c.widgetRunSearch({callback:function(){e.enableDragging()}})}};GEvent.bind(e,"dragend",this,this.endMapDrag);GEvent.bind(e,"dragstart",this,this.startMapDrag);this.infoWindowOpened=function(){this.blockSearch=1};this.infoWindowClosed=function(){this.blockSearch=0;c.widgetRunSearch({callback:function(){e.enableDragging()}})};GEvent.bind(e,"infowindowopen",this,this.infoWindowOpened);
GEvent.bind(e,"infowindowbeforeclose",this,this.infoWindowClosed);this.yVIHLookup=function(a){if(!a||a.Status.code!=200)alert("Status Code:"+a.Status.code);else{place=a.Placemark[0];a=place.AddressDetails.Country.AdministrativeArea.Locality.PostalCode.PostalCodeNumber;text='<div class="info_window">';text+="<p></p>";text+='<p><a target="_blank" href="http://yourvoiceinhouse.org.au/index.php?page=results&pcode='+a+'">Click Here</a> to find your local members of parliament<br/> (You will be redirected to the Your Voice In House website in a new window.)</p>';
text+="</div>";e.openInfoWindowHtml(application.current_point,text)}};this.YVIHPopup=function(){geocoder.getLocations(application.current_point,this.yVIHLookup)}}
function PanelManager(e){var c=this;this.autoFill=function(b,d){$(b).css({color:"#b2adad"}).attr({value:d}).focus(function(){$(this).val()==d&&$(this).val("").css({color:"#333"})}).blur(function(){$(this).val()==""&&$(this).css({color:"#b2adad"}).val(d)})};this.autoFill("#header_login_email","Username or Email");this.autoFill("#header_login_password","Password");this.autoFill(".gotoAddress","Suburb, Town, Country or Street Address");$(".map-button").qtip({position:{corner:{tooltip:"leftMiddle",target:"rightMiddle"}},
style:{tip:true,name:"green",fontWeight:800,border:{width:4,radius:6},textAlign:"center"},show:{solo:true}});$(".header-button").qtip({position:{corner:{tooltip:"topMiddle",target:"bottomMiddle"}},style:{tip:true,name:"green",fontWeight:800,border:{width:4,radius:6},textAlign:"center"},show:{solo:true}});$("#search_text").autocomplete({url:"/data/autocomplete_search.php",scrollHeight:320,extraParams:{nlat:function(){return e.getBounds().getNorthEast().lat()},elng:function(){return e.getBounds().getNorthEast().lng()},
slat:function(){return e.getBounds().getSouthWest().lat()},wlng:function(){return e.getBounds().getSouthWest().lng()}},formatResult:function(b){return b[0].replace(/\s<.*>$/,"")},matchContains:true});$("#search_text").clearableTextField();$("#search_text").keyup(function(b){b.keyCode==13&&application.resourceManager.widgetRunSearch({forceLoad:1,openExact:1})});$(".fg-button:not(.ui-state-disabled)").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}).mousedown(function(){$(this).parents(".fg-buttonset-single:first").find(".fg-button.ui-state-active").removeClass("ui-state-active");
$(this).is(".ui-state-active.fg-button-toggleable, .fg-buttonset-multi .ui-state-active")?$(this).removeClass("ui-state-active"):$(this).addClass("ui-state-active")}).mouseup(function(){$(this).is(".fg-button-toggleable, .fg-buttonset-single .fg-button,  .fg-buttonset-multi .fg-button")||$(this).removeClass("ui-state-active")});$("#inbox_tabs").tabs();$("#inbox_tabs").bind("tabsselect",function(){});$("#tabs_doco").tabs({});dialog_height=250;$("#map_dialog_add").dialog({title:"Add Listing",autoOpen:false,
resizable:true,width:400,height:150,position:"bottom",zindex:500});$("#map_dialog_location").dialog({title:"Change Location",autoOpen:false,resizable:true,width:400,height:150,position:"bottom",zindex:500});$("#map_dialog_yvih").dialog({title:"Your Voice In House",autoOpen:false,resizable:true,width:250,height:150,position:"bottom",zindex:500});$("#map_dialog_data").dialog({title:"Data Feeds",autoOpen:false,resizable:true,width:400,height:180,position:"bottom",zindex:500});$("#map_dialog_plugin").dialog({title:"Website Plugin",
autoOpen:false,resizable:true,width:350,height:220,position:"bottom",zindex:500});var a=null;this.setHeaderSize=function(){var b=e.getSize(),d=b.width;b=b.height;if(d<800){$("#header_center").css("width",d-20);$("#map_filter_center").css("width",d-20);$("#panel_center").css("width",d-20);$("#header_login_small").css("display","block");$("#header_login_large").css("display","none")}else{if(d<1E3){$("#header_center").css("width",d-120);$("#map_filter_center").css("width",d-120);$("#panel_center").css("width",
d-120)}else{$("#header_center").css("width",880);$("#map_filter_center").css("width",880);$("#panel_center").css("width",880)}$("#header_login_large").css("display","block");$("#header_login_small").css("display","none")}$("#searchPanelResults").css("height",b-100);$("#search_subtype_checkboxes").css("height",b-100)};$(window).bind("resize",function(){a&&clearTimeout(a);a=setTimeout("application.panelManager.setHeaderSize()",100)});this.login=function(b){$("#login_response").html('<img src="/images/wait_small.gif"/>');
application.user.login(b,this.loginSuccess,this.loginFailure)};this.loginSuccess=function(b){$("#login_response").html('<div class="ui-widget"><div class="ui-state-highlight ui-corner-all" style="padding: 0pt 0.7em; margin-top: 20px;"> <p><span class="ui-icon ui-icon-check" style="float: left; margin-right: 0.3em;"></span><b>Hi! You\'re logged in as '+b+"</b></p></div></div>");c.openInboxWindow(1);$(".show_logged_in").css("display","block");$(".show_logged_out").css("display","none");$("span[id^='your_name']").html(b)};
this.loginFailure=function(b){$("#login_response").html('<div class="ui-widget"><div class="ui-state-error ui-corner-all" style="padding: 0pt 0.7em; margin-top: 20px;"> <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: 0.3em;"></span><b>'+b+"</b></p></div></div>");c.openLoginWindow();$(".show_logged_in").css("display","none");$(".show_logged_out").css("display","block")};this.logOut=function(){application.user.logout(this.logoutSuccess);return false};this.logoutSuccess=function(){c.openHomeWindow();
$(".show_logged_in").css("display","none");$(".show_logged_out").css("display","block")};$("a[id^='logOutButton']").bind("click",function(){c.logOut();return false});this.register=function(b){$("#register_response").html('<img src="/images/wait_small.gif"/>');application.user.register(b,this.registerSuccess,this.registerFailure)};this.registerSuccess=function(){$("#register_response").html('<b style="color: green"><img src="/images/tick.jpeg" /> Great! We\'ve just sent you an email to confirm your email address, just click on the link in this email to complete sign up.</b>');
$(".register_step_2").css("display","table-row");$(".register_step_1").css("display","none")};this.registerFailure=function(b){$("#register_response").html('<b style="color: red"><img src="/images/cross.jpeg" />'+b+"</b>")};this.registerConfirm=function(b){$("#register_response").html('<img src="/images/wait_small.gif"/>');application.user.registerConfirm(b,this.registerConfirmSuccess,this.registerConfirmFailure)};this.registerConfirmSuccess=function(b){$("#register_response").html('<b style="color: green"><img src="/images/tick.jpeg" /> Hi! Youre logged in as '+
b+"!</b>");$("#login_response").html('<b style="color: green"><img src="/images/tick.jpeg" /> Hi! Youre logged in as '+b+"!</b>");$(".register_step_2").css("display","none");$(".register_step_1").css("display","table-row");$(".show_logged_in").css("display","block");$(".show_logged_out").css("display","none");$("span[id^='your_name']").html(b);c.openInboxWindow(1)};this.registerConfirmFailure=function(b){$("#register_response").html('<b style="color: red"><img src="/images/cross.jpeg" />'+b+"</b>")};
this.inviteConfirm=function(b){$("#register_response").html('<img src="/images/wait_small.gif"/>');application.user.inviteConfirm(b,this.inviteConfirmSuccess,this.inviteConfirmFailure)};this.inviteConfirmSuccess=function(b){$("#register_response").html('<b style="color: green"><img src="/images/tick.jpeg" /> Hi! Youre logged in as '+b+"!</b>");$("#login_response").html('<b style="color: green"><img src="/images/tick.jpeg" /> Hi! Youre logged in as '+b+"!</b>");$(".register_step_2").css("display",
"none");$(".register_step_1").css("display","table-row");$(".show_logged_in").css("display","block");$(".show_logged_out").css("display","none");$("span[id^='your_name']").html("Hi "+b);c.openInboxWindow()};this.inviteConfirmFailure=function(b){$("#register_response").html('<b style="color: red"><img src="/images/cross.jpeg" />'+b+"</b>")};this.loadProfile=function(b){$.get("/data/get_profile.php",{username:b},function(d){$("#pp_username").text(b);$("#pp_full_name").text($(d).find("full_name").text());
$("#pp_www").text($(d).find("www").text());$("#pp_blurb").text($(d).find("blurb").text())});$.getJSON("/data/get_markers.php",{format:"json",username:b},function(d){$("#pp_listings").html(" ");$.each(d.markers,function(f,g){results_found=f+1;g.point=new GLatLng(parseFloat(g.lat),parseFloat(g.lng));var h='<div class="listing_main" style="width: 85%;"><a href="#" onclick="application.panelManager.closeAllPanels(); application.resourceManager.openMarker('+g.lid+'); return(false);">'+g.name+"</a> ("+
g.subtype_name+')<div class="listing_sub"><span style="color:#666666">'+g.desc+g.address+g.phone+"</span></div>";$('<div class="listing_div"></div>').html(h).appendTo("#pp_listings")})})};this.openPanel=function(b){$("#panel_background").animate({opacity:"1"},500).fadeIn("slow",function(){$(".content_pane").css("display","none");$("#panel").fadeIn("slow");$(b).css("display","block");if(b=="#panel_home"){$("#header-tool-bar").animate({marginTop:"3.8em"},{queue:false,duration:500}).animate({marginLeft:"120px"},
{queue:false,duration:500}).animate({marginBottom:"3em"},{queue:false,duration:500});$("#panel_center").animate({marginTop:"8.4em"},{queue:false,duration:500})}else{$("#header-tool-bar").animate({marginTop:"0"},{queue:false,duration:500}).animate({marginLeft:"0px"},{queue:false,duration:500}).animate({marginBottom:"0px"},{queue:false,duration:500});$("#panel_center").animate({marginTop:"2.8em"},{queue:false,duration:500})}})};this.closeAllPanels=function(){$("#panel").fadeOut("fast",function(){$("#panel_background").fadeOut("slow",
function(){$("#map_zoom_div").fadeIn("slow")})});$("#header-tool-bar").animate({marginTop:"0px"},{queue:false,duration:500}).animate({marginLeft:"0px"},{queue:false,duration:500}).animate({marginBottom:"0em"},{queue:false,duration:500})};$("#mapButton").bind("click",function(){c.closeAllPanels();$("#dialog_map_tools").dialog("open")});this.openHomeWindow=function(){this.openPanel("#panel_home")};$("#homeButton").bind("click",function(){c.openHomeWindow()});this.openLoginWindow=function(){this.openPanel("#panel_login")};
$(".loginButton").bind("click",function(){c.openLoginWindow()});this.openInboxWindow=function(b){this.openPanel("#panel_inbox");if(b){application.user.refreshInboxRss();application.user.refreshInboxMarkers();application.user.refreshInboxConversations()}};$("#inboxButton").bind("click",function(){c.openInboxWindow(1)});this.openDocsWindow=function(){c.openPanel("#panel_docs")};$("#docsButton").bind("click",function(){c.openDocsWindow()});this.openProfileWindow=function(b){this.openPanel("#panel_profile");
this.loadProfile(b)};this.clickMap=function(b){b?application.onMapClick(null,b):application.onMapClick(null,e.getCenter())};this.gotoAddress=function(b,d){geocoder&&geocoder.getLatLng(b,function(f){if(f){e.setCenter(f,14);c.closeAllPanels();typeof d=="function"&&d(f)}else alert(b+" not found")})};this.widgetPluginCustomize=function(){var b=$("#widget_plugin_form select[name=start_screen] option:selected").val(),d=$("#widget_plugin_form select[name=theme] option:selected").val(),f=$("#widget_plugin_form select[name=size] option:selected").val(),
g=e.getCenter(),h=b=="map_filter"?"?theme="+d+"&zoom="+e.getZoom()+"&lat="+g.lat()+"&lng="+g.lng()+"&subtype="+application.resourceManager.current_filter_subtype+"&username="+application.resourceManager.current_filter_username:b=="map_restrict"?"?theme="+d+"&zoom="+e.getZoom()+"&lat="+g.lat()+"&lng="+g.lng()+"&r_subtype="+application.resourceManager.current_filter_subtype+"&r_username="+application.resourceManager.current_filter_username:"?theme="+d+"&zoom="+e.getZoom()+"&lat="+g.lat()+"&lng="+g.lng()+
"&subtype=all";if(f=="l")var j=1050,k=600;else if(f=="m"){j=850;k=500}else{j=650;k=400}$("#wpf_link").attr({href:"http://www.victoriamycommunity.org/plugin_preview.php?st="+b+"&su="+application.resourceManager.current_filter_subtype+"&username="+application.resourceManager.current_filter_username+"&th="+d+"&si="+f+"&zoom="+e.getZoom()+"&lat="+g.lat()+"&lng="+g.lng()+""});$("#wpf_code").attr({value:'<iframe style="border: none; width:'+j+"px; height:"+k+'px;" src="www.victoriamycommunity.org/index.php'+
h+'"></iframe>'})};this.feedsCustomize=function(){var b=e.getBounds(),d=b.getNorthEast(),f=b.getSouthWest();b=d.lat();d=d.lng();var g=f.lat();f=f.lng();e.getCenter();var h=application.resourceManager.current_filter_subtype,j=application.resourceManager.current_filter_text,k=application.resourceManager.current_filter_username;$("#listings_feed_xml").attr({href:"http://www.victoriamycommunity.org/data/get_markers.php?format=xml&north_lat="+b+"&east_lng="+d+"&south_lat="+g+"&west_lng="+f+"&filter_subtype="+
h+"&filter_text="+j+"&username="+k});$("#listings_feed_kml").attr({href:"http://www.victoriamycommunity.org/data/get_markers.php?format=kml&north_lat="+b+"&east_lng="+d+"&south_lat="+g+"&west_lng="+f+"&filter_subtype="+h+"&filter_text="+j+"&username="+k});$("#listings_feed_csv").attr({href:"http://www.victoriamycommunity.org/data/get_markers.php?format=csv&north_lat="+b+"&east_lng="+d+"&south_lat="+g+"&west_lng="+f+"&filter_subtype="+h+"&filter_text="+j+"&username="+k})};this.search_bg_color=$("#map_filter_center").css("background-color");
this.show_results_timer=null;this.showResults=function(){$("#searchPanelResults").slideDown("normal");$("#show_results_button").html("<b>Hide Results</b>");$("#show_results_button").unbind("click",c.showResults).click(c.hideResults);c.hideAdvanced();c.hideNoResults()};this.hideResults=function(){$("#searchPanelResults").slideUp("normal");$("#show_results_button").html("<b>Show Results</b>");$("#show_results_button").unbind("click",c.hideResults).click(c.showResults)};$("#map_div").mouseenter(function(){c.hideResults()});
this.showNoResults=function(){$("#searchPanelNoResults").slideDown("normal");$("#show_results_button").hide();c.hideResults();c.hideAdvanced()};this.hideNoResults=function(){$("#searchPanelNoResults").slideUp("normal");$("#show_results_button").show()};this.showAdvanced=function(){$("#search_subtype_checkboxes").slideDown("normal");$("#advanced_button").html("Hide Advanced");$("#advanced_button").unbind("click",c.showAdvanced).click(c.hideAdvanced);c.hideResults();c.hideNoResults()};this.hideAdvanced=
function(){$("#search_subtype_checkboxes").slideUp("normal");$("#advanced_button").html("Advanced");$("#advanced_button").unbind("click",c.hideAdvanced).click(c.showAdvanced)};this.flashSearchBox=function(){$("#search_text").animate({backgroundColor:"#FFDE40"},{queue:true,duration:200}).animate({backgroundColor:"white"},{queue:true,duration:1E3})}}
function User(){var e=this;this.full_name=this.username=this.email=null;this.isLoggedIn=function(){return this.username===null?false:true};this.refreshIsLoggedIn=function(){$.post("/data/is_logged_in.php",{},function(c){if($(c).find("response_state").attr("success")=="true"){e.email=$(c).find("user").attr("email");e.full_name=$(c).find("user").attr("full_name");e.username=$(c).find("user").attr("username");$(".show_logged_in").css("display","block");$(".show_logged_out").css("display","none");$("span[id^='your_name']").html(e.full_name)}})};
this.refreshIsLoggedIn();this.logout=function(c){$.post("/data/logout.php",{},function(a){$("#register_wait").css("display","none");if($(a).find("response_state").attr("success")=="true"){e.clearUser();c&&c(e.username)}})};this.clearUser=function(){this.full_name=this.email=this.username=null};this.login=function(c,a,b){var d=c.email.value;c=c.password.value;d!=""&&c!=""?$.post("/data/login.php",{email_or_username:d,password:c},function(f){$("#register_wait").css("display","none");if($(f).find("response_state").attr("success")==
"true"){e.email=$(f).find("user").attr("email");e.full_name=$(f).find("user").attr("full_name");e.username=$(f).find("user").attr("username");a&&a(e.username)}else b&&b("Incorext username or password, please try again.")}):b("You need to provide your email and password to log in.")};this.register=function(c,a,b){var d=c.email.value,f=c.password.value,g=c.full_name.value;c=c.username.value;if(d!=""&&f!=""&&g!=""&&c!="")$.post("/data/register.php",{email:d,password:f,full_name:g,username:c},function(h){$("#register_wait").css("display",
"none");if($(h).find("response_state").attr("success")=="true")a&&a();else if($(h).find("error").attr("error_code")=="email_exists")b&&b("Sorry, this email address has already registered!");else if($(h).find("error").attr("error_code")=="username_exists")b&&b("Sorry, this username has already registered!");else $(h).find("error").attr("error_code")=="db_error"&&b&&b("Sorry, there was a DB Error, please try again later.")});else b&&b("Sorry, you must fill in all fields to register!")};this.registerConfirm=
function(c,a,b){document.getElementById("login_response").innerHTML='<img src="/images/wait_small.gif"/>';var d=c.email.value;c=c.rego_code.value;if(c!=""&&d!="")$.post("/data/register_confirm.php",{rego_code:c,email:d},function(f){$("#register_wait").css("display","none");if($(f).find("response_state").attr("success")=="true"){e.email=$(f).find("user").attr("email");e.full_name=$(f).find("user").attr("full_name");e.username=$(f).find("user").attr("username");a&&a(e.username)}else $(f).find("error").attr("error_code")==
"incorrect_rego_code"&&b&&b("Incorrect confirmation code, check your details and try again")});else b&&b("You need to provide your email and the rego code sent to this email address to confirm your registration!")};this.inviteConfirm=function(c,a,b){var d=c.email.value,f=c.password_invite.value,g=c.full_name_invite.value,h=c.username_invite.value;c=c.rego_code.value;if(d!=""&&f!=""&&g!=""&&h!="")$.post("/data/invite_confirm.php",{email:d,password:f,full_name:g,username:h,rego_code:c},function(j){$("#register_wait").css("display",
"none");if($(j).find("response_state").attr("success")=="true"){e.email=$(j).find("user").attr("email");e.full_name=$(j).find("user").attr("full_name");e.username=$(j).find("user").attr("username");a&&a(e.username)}else if($(j).find("error").attr("error_code")=="username_exists")b&&b("Sorry, this username has already registered!");else $(j).find("error").attr("error_code")=="db_error"&&b&&b("Sorry, there was a DB Error, please try again later.")});else b&&b("Sorry, you must fill in all fields to register!")};
this.conversationReply=function(c,a){$("#conversation_reply_button").html('<image id="conversation_reply_wait" src="/images/wait_small_white.gif"/>');$.post("/data/add_conversation_message.php",{conversation_id:c,message:a},function(){e.refreshConversation(c)})};this.conversationNew=function(c,a,b){$("#inbox_tabs").tabs("select",0);$("#conversation_reply_wait").css("display","inline");$.post("/data/add_conversation.php",{users:c,title:a,message:b},function(){e.refreshInboxConversations()})};this.conversationDelete=
function(c){var a="";for(i=0;i<c.conversation_id.length;i++)if(c.conversation_id[i].checked==true)a+=c.conversation_id[i].value+",";$.post("/data/delete_conversation.php",{conversation_ids:a},function(){e.refreshInboxConversations()})};this.rssAdd=function(c){$.post("/data/add_rss.php",{rss:c})};this.refreshConversation=function(c){$("#inbox_tabs").tabs("select",0);if(this.isLoggedIn()){$("#message-inbox").hide("fast",function(){$("#message-edit").slideDown("fast")});$.post("/data/get_conversation.php",
{conversation_id:c},function(a){var b=$(a).find("conversation").attr("title");$("#inbox_conversation").html('<div class="listing_div"><div class="listing_left" style="width: 20%;">&nbsp;</div><div class="listing_main"><h3>'+b+"</h3></div>");$(a).find("conversation_message").each(function(){var d=$(this).attr("message"),f=$(this).attr("user"),g=$(this).attr("timestamp");$('<div class="listing_div"></div>').html('<div class="listing_left" style="width: 20%;">'+f+'<br><div class="listing_sub">'+g+'</div></div><div class="listing_main">'+
d+"</div>").appendTo("#inbox_conversation")});$("#inbox_conversation").append('<div class="listing_div"><div class="listing_left" style="width: 20%;">&nbsp;</div><div class="listing_main"><b>Reply: </b><br><form class="fg-form" action="#" name="replyform"><textarea name="reply" class="fg-input ui-corner-all" style="width:400px; height:100px; margin-bottom: 0.4em;"></textarea><br><button id="conversation_reply_button" type="button" class="fg-button ui-corner-all ui-state-default" onclick="application.user.conversationReply('+
c+', this.form.reply.value);">Send</button></form></div></div>')})}};this.refreshConversationNew=function(c,a){$("#inbox_tabs").tabs("select",0);if(a=="email"||a=="username")$("#inbox_conversations").html('<h2 style="margin-left: 155px;">New Conversation</h2><p style="margin-left: 155px;">Between YOU and User '+c+'</p><hr><div id="conversation_reply" style="margin-left:155px;"><form action="#" name="replyform"><input name="title" style="width:400px;"/><br><textarea name="message" style="width:400px; height:100px;"></textarea><br><input type="button" value="Send" class="button" onclick="application.user.conversationNew(\''+
c+'\', this.form.title.value, this.form.message.value);"><image style="margin: 4px; display:none;" id="conversation_reply_wait" src="/images/wait_small.gif"/></form></div> ');else a=="text"&&$("#inbox_conversations").html('<h2 style="margin-left: 155px;">Contact Details</h2><p style="margin-left: 155px;">Contact Deatils: '+c+"</p>");application.panelManager.openInboxWindow()};this.refreshInboxConversations=function(){if(this.isLoggedIn()){$("#message-edit").hide("fast",function(){$("#message-inbox").slideDown("fast");
$("#message-edit").css("display","none")});$.post("/data/get_all_conversations.php",{},function(c){$("#inbox_conversations").html("");$(c).find("conversation").each(function(){var a=$(this).attr("title"),b=$(this).attr("conversation_id"),d=$(this).attr("participants"),f=$(this).attr("timestamp"),g=$(this).attr("last_message"),h="";if($(this).attr("read_flag")==0)h='<image src="/images/unread_star.jpg"/>';$('<div class="listing_div"></div>').html('<div class="listing_left" style="width: 5%; clear: left;">'+
h+'<input name="conversation_id" type="checkbox" value="'+b+'"/></div><div class="listing_left" style="width: 15%;">'+d+'<br><div class="listing_sub">'+f+'</div></div><div class="listing_main"><a href="#" onclick="application.user.refreshConversation('+b+'); return(false);">'+a+' &nbsp; &nbsp; (view message)</a><div class="listing_sub">'+g+"</div></div>").appendTo("#inbox_conversations")})})}};this.refreshInboxRss=function(){if(this.isLoggedIn()){$("#news_wait").css("display","inline");$.post("/data/get_inbox_rss.php",
{},function(c){$("#news_wait").css("display","none");$("#inbox_rss_feeds").html(" ");$(c).find("feed").each(function(a){var b=$(this).attr("url");$('<div class="listing_div" style="min-height: 5em;"></div>').html('<div class="listing_left" style="width: 5%; clear: left;"><input type="checkbox"/></div><div class="listing_main" id="inbox_rss_'+a+'" style="width: 85%;"><img src="/images/wait_small.gif"/></div>').appendTo("#inbox_rss_feeds");$.getFeed({url:"/rss_proxy/?url="+b,success:function(d){var f=
d.title+"<ul>";for(var g in d.items){var h=d.items[g];f+='<li><a href="'+h.link+'">'+h.title+"</a><br>"+h.desc.substring(0,144)+"</li>"}f+="</ul>";$("#inbox_rss_"+a).html(f).find("ul").ticker("init",{delay:5E3,speed:500,linked:true,selection:"li",animations:{_in:"fadeIn",out:"fadeOut"}}).ticker("loop")}})})})}};this.refreshInboxMarkers=function(){if(this.isLoggedIn()){$("#resources_wait").css("display","inline");$.get("/data/get_markers.php",{username:this.username},function(c){$("#inbox_markers").html(" ");
$("#resources_wait").css("display","none");$(c).find("marker").each(function(){var a=$(this).attr("name"),b=$(this).attr("lid"),d=$(this).attr("subtype"),f=$(this).attr("desc");$('<div class="listing_div"></div>').html('<div class="listing_left" style="width: 5%; clear: left;"><input type="checkbox"/></div><div class="listing_main" style="width: 85%;"><a href="#" onclick="application.panelManager.closeAllPanels(); application.resourceManager.openMarker('+b+'); return(false);">'+a+'</a> <span style="color:#666666"> - '+
f+'</span><div class="listing_sub">Map Resource: <span style="font-weight: 800; color: #000">'+d+'</span></a> &nbsp; | <a href="#">Edit</a></div>').appendTo("#inbox_markers")})})}}}function AGCApp(){this.current_point="NULL";map=new GMap2(document.getElementById("map_div"));map.setCenter(new GLatLng(0,0),3);GEvent.bind(map,"click",this,this.onMapClick);this.user=new User(map);this.resourceManager=new ResourceManager(map);this.panelManager=new PanelManager(map);this.panelManager.setHeaderSize()}
AGCApp.prototype.onMapClick=function(e,c){if(e&&e.type){this.resourceManager.current_marker=e;e.openInformationWindow()}else if(c){this.current_point=c;$("#accordion h3").index($("#accordion h3.ui-state-active"));if($("#map_dialog_add").dialog("isOpen")){this.resourceManager.widgetRunSearch({text:"",subtypes:""});text='<div class="info_window">';if(application.user.isLoggedIn()){text+="<p><b>Add Listing at this location:</b><br/><br/>";text+="Choose a Listing Category from the dropdown list below.</p>";
text+='<form class="fg-form"><select class="fg-input ui-corner-all" style="width: 100%;" name="subtype" onchange="application.resourceManager.addResource(this.form)">';text+="<option>select a type of resource to add...<option/>";var a="";for(key in application.resourceManager.marker_types)if(application.resourceManager.marker_types[key].is_addable==1)if(application.resourceManager.marker_types[key].type_name===a)text+='<option value="'+application.resourceManager.marker_types[key].subtype+'">'+application.resourceManager.marker_types[key].subtype_name+
"</option>";else{text+=a===""?"":"</optgroup>";a=application.resourceManager.marker_types[key].type_name;text+='<optgroup label="'+a+'"><option value="'+application.resourceManager.marker_types[key].subtype+'">'+application.resourceManager.marker_types[key].subtype_name+"</option>"}text+="</optgroup></select></form><br/><br/><strong>Not the right location?</strong>  Click the map to change location, or provide extra detail to the address field."}else{text+="<p><b>Add Anonymous Listing at this location:</b><br/><br/>";
text+="Choose a Listing Category from the dropdown list below.</p>";text+='<form class="fg-form"><select class="fg-input ui-corner-all" style="width: 100%;" name="subtype" onchange="application.resourceManager.addResource(this.form)">';text+="<option>select a type of resource to add...<option/>";a="";for(key in application.resourceManager.marker_types)if(application.resourceManager.marker_types[key].is_addable==1)if(application.resourceManager.marker_types[key].type===a)text+='<option value="'+application.resourceManager.marker_types[key].subtype+
'">'+application.resourceManager.marker_types[key].subtype_name+"</option>";else{text+=a===""?"":"</optgroup>";a=application.resourceManager.marker_types[key].type;text+='<optgroup label="'+a+'"><option value="'+application.resourceManager.marker_types[key].subtype+'">'+application.resourceManager.marker_types[key].subtype_name+"</option>"}text+='</optgroup></select></form><br/><a href="#" onclick="application.panelManager.openLoginWindow(); return(false);">Login</a> or <a href="#" onclick="application.panelManager.openHomeWindow(); return(false);">Sign Up</a> to add a listing that you can track and manage..<br/><br/><strong>Not the right location?</strong>  Click the map to change location, or provide extra detail to the address field.'}map.openInfoWindowHtml(c,
text)}else $("#map_dialog_yvih").dialog("isOpen")&&application.resourceManager.YVIHPopup()}};function stopRKey(e){e=e?e:event?event:null;var c=e.target?e.target:e.srcElement?e.srcElement:null;if(e.keyCode==13&&c.type=="text")return false}var application,load=function(){if(GBrowserIsCompatible()){application=new AGCApp;this.geocoder=new GClientGeocoder;$("#error_load_message").css("display","none")}else alert("Sorry, the Google Maps API is not compatible with this browser")};